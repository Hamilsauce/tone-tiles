<!DOCTYPE html>
<html>

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700;900&display=swap" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Roboto:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">
  <title>Tone Tiles</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/rxjs/7.3.0/rxjs.umd.min.js" integrity="sha512-y3JTS47nnpKORJX8Jn1Rlm+QgRIIZHtu3hWxal0e81avPrqUH48yk+aCi+gprT0RMAcpYa0WCkapxe+bpBHD6g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <link rel="stylesheet" href="./css/main.css" />
  <link rel="stylesheet" href="./css/minimap.css" />
  <link rel="stylesheet" href="./css/app.css" />
  <link rel="stylesheet" href="./css/tile.css" />
  <link rel="stylesheet" href="./css/actor.css" />
  <link rel="stylesheet" href="./css/toolbar.css" />
  
  <link rel="stylesheet" href="./selection-box/selection-box.css" />
  <link rel="stylesheet" href="./css/app-footer.css" />
  <link rel="stylesheet" href="./css/app-header.css" />
  <link rel="stylesheet" href="./css/app-map-creation.css" />
</head>

<body>
  <div id="app-host"></div>
  <script type="importmap">
    {
  "imports": {
    "vue": "https://unpkg.com/vue@3.4.21/dist/vue.esm-browser.js",
    "vue-router": "https://unpkg.com/vue-router@4.3.0/dist/vue-router.esm-browser.js",
    "@vue/devtools-api": "data:text/javascript,export function setupDevtoolsPlugin(){};export function getDevtoolsGlobalHook(){ return undefined; };"
  }
}
</script>
  
  <!-- <script type="importmap">
    {
    "imports": {
      "vue": "https://unpkg.com/vue@3.4.21/dist/vue.esm-browser.js",
  "vue-router": "https://unpkg.com/vue-router@4.3.0/dist/vue-router.esm-browser.js",
  "@vue/devtools-api": "https://unpkg.com/@vue/devtools-api@6.6.1/dist/devtools-api.esm-browser.js"
    }
  }
  </script> -->
  
  <!-- <script type="importmap">
  {
  "imports": {
    "vue": "https://unpkg.com/vue@3/dist/vue.esm-browser.js",
    "vue-router": "https://unpkg.com/vue-router@4/dist/vue-router.esm-browser.js",
    "@vue/devtools-api": "https://unpkg.com/@vue/devtools-api@6/dist/devtools-api.esm-browser.js",
    
  }
  }
  </script> -->
  
  <script src="https://www.gstatic.com/firebasejs/12.0.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore-compat.js"></script>
  
  <script type="text/javascript" charset="utf-8">
    const SVG_NS = 'http://www.w3.org/2000/svg';
  </script>
  <script src="./main.js" type="module"></script>
  <script src="./script.js" type="module"></script>
  <!-- <script src="./script-dynamic-bfs.js" type="module"></script> -->
  
  <template data-component="app-floating-menu">
    <div id="app-floating-menu" ref="floatingMenuRef" :class="{ expanded: displayState === 'expanded' }" top="300px" left="200px">
      <div v-if="displayState === 'collapsed'" @click.stop="handleDisplayChange('expanded')" id="app-floating-menu-collapsed">
        <svg id="menu-icon" width="50" height="50" viewBox="-2.5 -2.5 30 30" preserveAspectRatio="xMidYMid meet" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg">
          <path fill="#FFFFFF" d="M 11.7 20H11.3L10.9 17.4C9.7 17.2 8.7 16.5 7.9 15.6L5.5 16.6L4.7 15.3L6.8 13.7C6.4 12.5 6.4 11.3 6.8 10.1L4.7 8.7L5.5 7.4L7.9 8.4C8.7 7.5 9.7 6.9 10.9 6.6L11.2 4H12.7L13.1 6.6C14.3 6.8 15.4 7.5 16.1 8.4L18.5 7.4L19.3 8.7L17.2 10.2C17.4 10.8 17.5 11.4 17.5 12H18C18.5 12 19 12.1 19.5 12.2V12L19.4 11L21.5 9.4C21.7 9.2 21.7 9 21.6 8.8L19.6 5.3C19.5 5 19.3 5 19 5L16.5 6C16 5.6 15.4 5.3 14.8 5L14.4 2.3C14.5 2.2 14.2 2 14 2H10C9.8 2 9.5 2.2 9.5 2.4L9.1 5.1C8.5 5.3 8 5.7 7.4 6L5 5C4.7 5 4.5 5 4.3 5.3L2.3 8.8C2.2 9 2.3 9.2 2.5 9.4L4.6 11L4.5 12L4.6 13L2.5 14.7C2.3 14.9 2.3 15.1 2.4 15.3L4.4 18.8C4.5 19 4.7 19 5 19L7.5 18C8 18.4 8.6 18.7 9.2 19L9.6 21.7C9.6 21.9 9.8 22.1 10.1 22.1H12.6C12.1 21.4 11.9 20.7 11.7 20M16 12.3V12C16 9.8 14.2 8 12 8S8 9.8 8 12C8 14.2 9.8 16 12 16C12.7 14.3 14.2 12.9 16 12.3M10 12C10 10.9 10.9 10 12 10S14 10.9 14 12 13.1 14 12 14 10 13.1 10 12M18 14.5V13L15.8 15.2L18 17.4V16C19.4 16 20.5 17.1 20.5 18.5C20.5 18.9 20.4 19.3 20.2 19.6L21.3 20.7C22.5 18.9 22 16.4 20.2 15.2C19.6 14.7 18.8 14.5 18 14.5M18 21C16.6 21 15.5 19.9 15.5 18.5C15.5 18.1 15.6 17.7 15.8 17.4L14.7 16.3C13.5 18.1 14 20.6 15.8 21.8C16.5 22.2 17.2 22.5 18 22.5V24L20.2 21.8L18 19.5V21Z"></path>
        </svg>
      </div>
      <div v-if="displayState === 'expanded'" @click.stop="handleDisplayChange('collapsed')" id="app-floating-menu-expanded">
        <router-view></router-view>
      </div>
    </div>
  </template>
  
  <template data-component="app">
    <div id="app">
      <app-header @footertoggle="handleFooterChange"></app-header>
      <router-view></router-view>
      
      <app-footer></app-footer>
      <app-floating-menu></app-floating-menu>
    </div>
  </template>
  
  <template data-component="app-header">
    <header id="app-header">
      <div id="app-header-left"></div>
      <div id="app-header-center">
        <h2>tone tiles</h2>
        <div id="app-header-center-bottom"></div>
      </div>
      <div id="app-header-right">
        <div id="app-state-display"></div>
      </div>
      <div id="app-header-top">
        <div class="container">
          <label for="map-input">Pick Map</label>
          <select name="map-input" id="map-input">
            <option value="MAP_9X15_1">MAP_9X15_1</option>
            <option value="BLANK_MAP_9X15_1">BLANK_MAP_9X15_1</option>
            <option value="suk">suk</option>
            <option value="BIG_ASS_MAP">BIG_ASS_MAP</option>
          </select>
        </div>
        <div class="container">
          <button id="new-map" @click="handleNewMap" class="file-button" type="button">New</button>
          <button id="save-map" class="file-button" type="button">Save</button>
        </div>
      </div>
    </header>
  </template>
  
  <template data-component="svg-canvas-host">
    <div id="svg-canvas-host" pointer-events="auto">
      <svg _@click="handleClick" id="canvas" class="gradient" width="412" _height="681" viewBox="-0 -0 9 15" preserveAspectRatio="xMidYMid meet" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <marker id="edge-line-arrow" viewBox="0 0 10 10" refX="5" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse">
            <path d="M 0 0 L 10 5 L 0 10 z" fill="black" />
          </marker>
          
          <!-- <foreignObject data-template="context-menu" id="context-menu-container" class="context-menu-foreignobject" pointer-events="auto" x="0" y="0" width="200" height="30" _transform="translate(0,0) rotate(0) scale(1)">
            <div xmlns="http://www.w3.org/1999/xhtml" class="context-menu" data-show-actions="false">
              <ul class="context-menu-list">
                <li data-value="barrier" data-type="tile-type">barrier</li>
                <li data-value="empty" data-type="tile-type">empty</li>
                <li data-value="start" data-type="tile-type">start</li>
                <li data-value="teleport" data-type="tile-type">teleport</li>
                <li data-value="link-teleport" data-type="tile-action">Link to...</li>
              </ul>
            </div>
          </foreignObject> -->
          
          <g data-template="context-menu" id="context-menu-container" pointer-events="auto" data-show-actions="false" data-show="false" transform="translate(0,0) rotate(0) scale(0.05)">
            <foreignObject class="context-menu-foreignobject" pointer-events="auto" x="0" y="0" width="200" height="30" _transform="translate(0,0) rotate(0) scale(1)">
              <div xmlns="http://www.w3.org/1999/xhtml" class="context-menu" data-show-actions="false">
                <ul class="context-menu-list">
                  <li data-value="barrier" data-type="tile-type">barrier</li>
                  <li data-value="empty" data-type="tile-type">empty</li>
                  <li data-value="start" data-type="tile-type">start</li>
                  <li data-value="teleport" data-type="tile-type">teleport</li>
                  <li data-value="link-teleport" data-type="tile-action">Link to...</li>
                </ul>
              </div>
            </foreignObject>
          </g>
          
          <g data-template="actor" id="" data-x="0" data-y="0" data-teleporting="false" class="actor" transform="translate(0,0) rotate(0) scale(1)">
            <circle cx="0.5" cy="0.5" r="0.4" transform="translate(0,0) rotate(0) scale(1)" />
          </g>
          
          <g data-template="edge-line" class="edge-line" id="" data-x="0" data-y="0" transform="translate(0,0) rotate(0) scale(1)">
            <line x1="0" y1="0" x2="1" y2="1" marker-end="url(#edge-line-arrow)" transform="translate(0,0) rotate(0) scale(1)" />
          </g>
          
        </defs>
        
        <g id="viewport" ref="canvasViewportRef" transform="matrix(1 0 0 1 0 0)">
          
          <g id="scene" transform="translate(0,0) rotate(0) scale(1)">
            <g id="surface-layer" transform="translate(-0,-0) rotate(0) scale(1)">
              <rect id="surface" class="gradient" x="0" y="0" rx="0" ry="0" width="10" height="15"></rect>
            </g>
            
            <g id="tile-layer" transform="translate(-0,-0) rotate(0) scale(1)"></g>
            
            <g id="object-layer" transform="translate(0.5,0.5) rotate(0) scale(1)"></g>
          </g>
        </g>
        
        <g id="minimap" data-x="0" data-y="0" transform="translate(13, 17) rotate(0) scale(0.3)">
          <rect id="minimap-surface" x="0" y="0" rx="0" ry="0" width="19" height="22"></rect>
          <use href="#scene" transform="translate(0,0) rotate(0) scale(1)"></use>
        </g>
      </svg>
    </div>
  </template>
  
  <!-- <template data-component="app-map-creation">
    <section id="app-map-creation">
      
    </section>
  </template> -->
  
  <template data-component="app-map-creation">
    <section id="app-map-creation" class="map-create">
      <!-- Header -->
      <header class="map-create__header">
        <div class="map-create__titlewrap">
          <h2 class="map-create__title">New map</h2>
          <p class="map-create__subtitle">Set the basics. You can resize later in Map Settings.</p>
        </div>
        
        <div class="map-create__actions">
          <button type="button" class="btn btn--ghost" data-action="cancel">Cancel</button>
          <button type="submit" class="btn btn--primary" form="map-create-form" data-action="create">
            Create map
          </button>
        </div>
      </header>
      
      <!-- Body -->
      <div class="map-create__body">
        <form id="map-create-form" class="map-create__form" autocomplete="off" novalidate>
          <!-- Name -->
          <div class="field">
            <label class="field__label" for="map-name">Name</label>
            <input id="map-name" name="name" type="text" class="field__input" placeholder="e.g. Cat Town – West Gate" maxlength="80" required data-bind="name" />
            <div class="field__hint">Optional. If blank, we’ll generate one.</div>
          </div>
          
          <!-- Presets -->
          <fieldset class="fieldset">
            <legend class="fieldset__legend">Preset</legend>
            <div class="preset-row" role="group" aria-label="Map size presets">
              <button type="button" class="chip" data-preset="small">Small</button>
              <button type="button" class="chip" data-preset="medium">Medium</button>
              <button type="button" class="chip" data-preset="large">Large</button>
              <button type="button" class="chip chip--ghost" data-preset="custom" aria-pressed="true">
                Custom
              </button>
            </div>
            <div class="fieldset__hint">Presets set width/height and tile size. You can fine-tune below.</div>
          </fieldset>
          
          <!-- Dimensions -->
          <fieldset class="fieldset">
            <legend class="fieldset__legend">Dimensions</legend>
            
            <div class="grid-2">
              <div class="field">
                <label class="field__label" for="map-width">Width (tiles)</label>
                <input id="map-width" name="width" type="number" class="field__input" inputmode="numeric" min="4" max="256" step="1" value="32" required data-bind="width" />
              </div>
              
              <div class="field">
                <label class="field__label" for="map-height">Height (tiles)</label>
                <input id="map-height" name="height" type="number" class="field__input" inputmode="numeric" min="4" max="256" step="1" value="32" required data-bind="height" />
              </div>
            </div>
            
            <div class="field">
              <label class="field__label" for="map-tilesize">Tile size</label>
              <div class="range">
                <input id="map-tilesize" name="tileSize" type="range" class="range__input" min="8" max="64" step="1" value="24" data-bind="tileSize" />
                <output class="range__value" for="map-tilesize" data-out="tileSize">24</output>
                <span class="range__unit">px</span>
              </div>
              <div class="field__hint">Visual scale. (If you treat tile size as logical resolution later, move this to Map Settings.)</div>
            </div>
          </fieldset>
          
          <!-- Initialize -->
          <fieldset class="fieldset">
            <legend class="fieldset__legend">Initialize</legend>
            
            <div class="grid-2">
              <label class="radio">
                <input type="radio" name="initFill" value="empty" checked data-bind="initFill" />
                <span class="radio__label">Empty</span>
                <span class="radio__hint">All tiles start empty.</span>
              </label>
              
              <label class="radio">
                <input type="radio" name="initFill" value="barrier" data-bind="initFill" />
                <span class="radio__label">Barrier border</span>
                <span class="radio__hint">Border walls, empty interior.</span>
              </label>
            </div>
            
            <div class="divider"></div>
            
            <div class="grid-2">
              <div class="field">
                <label class="field__label" for="map-start">Start</label>
                <select id="map-start" name="startPlacement" class="field__select" data-bind="startPlacement">
                  <option value="bottom-left" selected>Bottom-left</option>
                  <option value="top-left">Top-left</option>
                  <option value="bottom-right">Bottom-right</option>
                  <option value="top-right">Top-right</option>
                  <option value="none">None</option>
                </select>
              </div>
              
              <div class="field">
                <label class="field__label" for="map-exit">Exit</label>
                <select id="map-exit" name="exitPlacement" class="field__select" data-bind="exitPlacement">
                  <option value="bottom-right" selected>Bottom-right</option>
                  <option value="top-right">Top-right</option>
                  <option value="bottom-left">Bottom-left</option>
                  <option value="top-left">Top-left</option>
                  <option value="none">None</option>
                </select>
              </div>
            </div>
            
            <label class="check">
              <input type="checkbox" name="openInEditor" checked data-bind="openInEditor" />
              <span class="check__label">Open in editor after creation</span>
            </label>
          </fieldset>
          
          <!-- Mobile sticky submit (optional, if your app uses bottom bars) -->
          <div class="map-create__footer">
            <button type="submit" class="btn btn--primary btn--full" data-action="create">
              Create map
            </button>
            <button type="button" class="btn btn--ghost btn--full" data-action="cancel">
              Cancel
            </button>
          </div>
        </form>
        
        <!-- Preview card -->
        <aside class="map-create__preview" aria-label="Map summary preview">
          <div class="card">
            <div class="card__header">
              <h3 class="card__title">Summary</h3>
            </div>
            <div class="card__content">
              <dl class="kv">
                <div class="kv__row">
                  <dt>Name</dt>
                  <dd data-preview="name">—</dd>
                </div>
                <div class="kv__row">
                  <dt>Grid</dt>
                  <dd><span data-preview="width">32</span> × <span data-preview="height">32</span></dd>
                </div>
                <div class="kv__row">
                  <dt>Tile size</dt>
                  <dd><span data-preview="tileSize">24</span>px</dd>
                </div>
                <div class="kv__row">
                  <dt>Init</dt>
                  <dd data-preview="initFill">Empty</dd>
                </div>
                <div class="kv__row">
                  <dt>Start / Exit</dt>
                  <dd>
                    <span data-preview="startPlacement">Bottom-left</span>
                    <span class="kv__sep">→</span>
                    <span data-preview="exitPlacement">Bottom-right</span>
                  </dd>
                </div>
              </dl>
              
              <div class="note">
                Tip: resizing later should prompt an anchor (expand right/down/center) to avoid surprises.
              </div>
            </div>
          </div>
        </aside>
      </div>
    </section>
  </template>
  
  
  <template data-component="app-body">
    <section id="app-body">
      <svg-canvas-host></svg-canvas-host>
    </section>
  </template>
  
  <template data-component="app-footer">
    <footer id="app-footer">
      <div id="app-footer-top">
        <div id="controls" data-controls="tile-brushes" class="container">
          <button class="app-button tile-selector" data-active="true" data-tile-type="barrier">Barrier</button>
          <button class="app-button tile-selector" data-tile-type="empty">Empty</button>
          <button class="app-button tile-selector" data-tile-type="teleporter">Teleporter</button>
          <button class="app-button tile-selector" data-tile-type="exit">Exit</button>
          <button class="app-button tile-selector" data-tile-type="start">Start</button>
          <button class="app-button tile-selector" data-tile-type="delete">DELETE</button>
        </div>
        <div class="scroll-fader"></div>
      </div>
      
      <div id="app-footer-bottom">
        <app-toolbar></app-toolbar>
      </div>
    </footer>
  </template>
  
  <template data-component="app-toolbar">
    <div id="app-toolbar">
      <div id="tools" :class="{ deactivated: isRunning }">
        <div id="app-run-toggle" :class="{ activated: !isRunning }" @click="handleClick" class="tool-label" data-active="false" data-tool-group="run">
          <!-- USE V IF TO TOGGLE -->
          <svg v-if="!isRunning" class="tool-label-icon" id="play-icon" width="24" height="24" viewBox="2 2 20 20" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            <path fill="#FFFFFF" d="M 10,16.5V7.5L16,12M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"></path>
          </svg>
          <svg v-if="isRunning" class="tool-label-icon" id="pause-icon" width="24" height="24" viewBox="2 2 20 20" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            <path fill="#FFFFFF" d="M 13,16V8H15V16H13M9,16V8H11V16H9M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4Z"></path>
          </svg>
        </div>
        <div class="tool-label" data-active="true" data-tool-group="tile" id="tile-brush-label">Tiles</div>
        <div class="tool-label" data-active="false" data-tool-group="select" _id="label">Select</div>
        <div class="tool-label" data-active="false" data-tool-group="actor" _id="label">Actors</div>
        <div class="tool-label" data-active="false" data-tool-group="layer" _id="label">Layers</div>
        <div class="tool-label" data-active="false" data-tool-group="color" _id="label">Colors</div>
        <div class="tool-label" data-active="false" data-tool-group="other" _id="label">Other</div>
      </div>
    </div>
  </template>
</body>

</html>